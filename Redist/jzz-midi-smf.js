/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/jzz-midi-smf@1.1.6/javascript/JZZ.midi.SMF.js
 * 
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r:"function"==typeof define&&define.amd?define("JZZ.midi.SMF",["JZZ"],r):r(JZZ)}(0,function(t){if(!t.MIDI.SMF){var r="1.1.6",i=t.lib.now;f.version=function(){return r},f.prototype=[],f.prototype.constructor=f,f.prototype.copy=function(){var t=new f;t.type=this.type,t.ppqn=this.ppqn,t.fps=this.fps,t.ppf=this.ppf,t.rmi=this.rmi,t.ntrk=this.ntrk;for(var r=0;r<this.length;r++)t.push(this[r].copy());return t},f.prototype._complain=function(t,r,i){this._warn||(this._warn=[]),this._warn.push(d(t,r,i))},f.prototype.load=function(t){var r=0;"RIFF"==t.substr(0,4)&&"RMIDdata"==t.substr(8,8)&&(this.rmi=!0,r=20,t=t.substr(20,t.charCodeAt(16)+256*t.charCodeAt(17)+65536*t.charCodeAt(18)+16777216*t.charCodeAt(19))),this.loadSMF(t,r)};var n="MThd"+String.fromCharCode(0)+String.fromCharCode(0)+String.fromCharCode(0)+String.fromCharCode(6);f.prototype.loadSMF=function(t,r){if(t.length||o("Empty file"),t.substr(0,8)!=n){var i=t.indexOf(n);-1!=i?(t=t.substr(i),this._complain(r,"Extra leading characters",i),r+=i):o("Not a MIDI file")}this.type=16*t.charCodeAt(8)+t.charCodeAt(9),this.ntrk=16*t.charCodeAt(10)+t.charCodeAt(11),t.charCodeAt(12)>127?(this.fps=256-t.charCodeAt(12),this.ppf=t.charCodeAt(13)):this.ppqn=256*t.charCodeAt(12)+t.charCodeAt(13),this.type>2?this._complain(8+r,"Invalid MIDI file type",this.type):0==this.type&&this.ntrk>1&&this._complain(10+r,"Wrong number of tracks for the type 0 MIDI file",this.ntrk),this.ppf||this.ppqn||o("Invalid MIDI header");for(var e=0,s=14;s<t.length-8;){var h=s+r,a=t.substr(s,4);"MTrk"==a&&e++;var p=(t.charCodeAt(s+4)<<24)+(t.charCodeAt(s+5)<<16)+(t.charCodeAt(s+6)<<8)+t.charCodeAt(s+7);p<=0&&(p=t.length-s-8,this._complain(s+r+4,"Invalid track length",t.charCodeAt(s+4)+"/"+t.charCodeAt(s+5)+"/"+t.charCodeAt(s+6)+"/"+t.charCodeAt(s+7))),s+=8;var f=t.substr(s,p);this.push(new _(a,f,h)),"MThd"==a&&this._complain(h,"Unexpected chunk type","MThd"),s+=p}e!=this.ntrk&&(this._complain(r+10,"Incorrect number of tracks",this.ntrk),this.ntrk=e),this.ntrk||o("No MIDI tracks"),(!this.type&&this.ntrk>1||this.type>2)&&(this.type=1),s<t.length&&this._complain(r+s,"Extra trailing characters",t.length-s),s>t.length&&this._complain(r+t.length,"Incomplete data",s-t.length)},f.prototype.validate=function(){var t,r,i=[];if(this._warn)for(t=0;t<this._warn.length;t++)i.push(u(this._warn[t]));for(r=0,t=0;t<this.length;t++)this[t]instanceof m&&(r++,this[t]._validate(i,r));if(i.sort(function(t,r){return(t.off||0)-(r.off||0)||(t.track||0)-(r.track||0)||(t.tick||0)-(r.tick||0)}),i.length)return i},f.prototype.dump=function(t){var r="";if(t)return"RIFF"+p((r=this.dump()).length+12)+"RMIDdata"+p(r.length)+r;this.ntrk=0;for(var i=0;i<this.length;i++)this[i]instanceof m&&this.ntrk++,r+=this[i].dump();return r=(this.ppqn?h(this.ppqn):String.fromCharCode(256-this.fps)+String.fromCharCode(this.ppf))+r,r=n+String.fromCharCode(0)+String.fromCharCode(this.type)+h(this.ntrk)+r},f.prototype.toString=function(){var t;for(this.ntrk=0,t=0;t<this.length;t++)this[t]instanceof m&&this.ntrk++;var r=["SMF:","  type: "+this.type];for(this.ppqn?r.push("  ppqn: "+this.ppqn):r.push("  fps: "+this.fps,"  ppf: "+this.ppf),r.push("  tracks: "+this.ntrk),t=0;t<this.length;t++)r.push(this[t].toString());return r.join("\n")},f.prototype.player=function(){var r,i,e=new S;e.ppqn=this.ppqn,e.fps=this.fps,e.ppf=this.ppf;var n,o=[],s=0,h=0;for(r=0;r<this.length;r++)this[r]instanceof m&&o.push(this[r]);if(2==this.type)for(r=0;r<o.length;r++){for(i=0;i<o[r].length;i++)(n=t.MIDI(o[r][i])).track=r,h=n.tt+s,n.tt=h,e._data.push(n);s=h}else{var a=[];for(r=0;r<o.length;r++)a[r]=0;for(;;){var p=!0;for(r=0;r<o.length;r++){for(;a[r]<o[r].length&&o[r][a[r]].tt==h;)(n=t.MIDI(o[r][a[r]])).track=r,e._data.push(n),a[r]++;a[r]>=o[r].length||(p&&(s=o[r][a[r]].tt),p=!1,s>o[r][a[r]].tt&&(s=o[r][a[r]].tt))}if(h=s,p)break}}if(e._duration=h,e._ttt=[],e.ppqn){for(e.mul=e.ppqn/500,s=e.mul,h=0,e._durationMS=0,e._ttt.push({t:0,m:s,ms:0}),r=0;r<e._data.length;r++)81==(n=e._data[r]).ff&&(e._durationMS+=(n.tt-h)/s,h=n.tt,s=1e3*this.ppqn/((n.dd.charCodeAt(0)<<16)+(n.dd.charCodeAt(1)<<8)+n.dd.charCodeAt(2)),e._ttt.push({t:h,m:s,ms:e._durationMS}));e._durationMS+=(e._duration-h)/s}else e.mul=e.fps*e.ppf/1e3,e._ttt.push({t:0,m:e.mul,ms:0}),e._durationMS=h/e.mul;return e._ttt.push({t:e._duration,m:0,ms:e._durationMS}),e._durationMS||(e._durationMS=1),e._type=this.type,e._tracks=o.length,e},f.Chunk=_,_.prototype=[],_.prototype.constructor=_,_.prototype.copy=function(){return new _(this.type,this.data)},_.prototype.sub={MTrk:function(t,r,i){return new m(r,i)}},_.prototype.dump=function(){return this.type+a(this.data.length)+this.data},_.prototype.toString=function(){return this.type+": "+this.data.length+" bytes"},f.MTrk=m,m.prototype=[],m.prototype.constructor=m,m.prototype.copy=function(){var r=new m;r.length=0;for(var i=0;i<this.length;i++)r.push(new t.MIDI(this[i]));return r},m.prototype._validate=function(t,r){var i,e;if(this._warn)for(i=0;i<this._warn.length;i++)(e=u(this._warn[i])).track=r,t.push(e);for(i=0;i<this.length;i++)(e=y(this[i]))&&(e.track=r,t.push(e))},m.prototype._complain=function(t,r,i,e){this._warn||(this._warn=[]),this._warn.push(d(t,r,i,e))},m.prototype.dump=function(){var t,r,i="",e=0,n="";for(t=0;t<this.length;t++)if(i+=s(this[t].tt-e),e=this[t].tt,void 0!==this[t].dd)i+="ÿ",i+=String.fromCharCode(this[t].ff),i+=s(this[t].dd.length),i+=this[t].dd;else if(240==this[t][0]||247==this[t][0])for(i+=String.fromCharCode(this[t][0]),i+=s(this[t].length-1),r=1;r<this[t].length;r++)i+=String.fromCharCode(this[t][r]);else for(this[t][0]!=n&&(n=this[t][0],i+=String.fromCharCode(this[t][0])),r=1;r<this[t].length;r++)i+=String.fromCharCode(this[t][r]);return"MTrk"+a(i.length)+i},m.prototype.toString=function(){for(var t=["MTrk:"],r=0;r<this.length;r++)t.push(this[r].tt+": "+this[r].toString());return t.join("\n  ")},m.prototype.add=function(r,i){if(r=parseInt(r),(isNaN(r)||r<0)&&o("Invalid parameter"),(i=t.MIDI(i)).tt=r,this[this.length-1].tt<r&&(this[this.length-1].tt=r),47==i.ff||255==i[0])return this;var e,n=v(i);for(e=0;e<this.length&&!(this[e].tt>r)&&!(this[e].tt==r&&v(this[e])>n);e++);return this.splice(e,0,i),this},m.prototype.send=function(t){this._orig.add(this._tick,t)},m.prototype.tick=function(t){if(t!=parseInt(t)||t<0)throw RangeError("Bad tick value: "+t);if(!t)return this;var r=function(){};r.prototype=this._orig;var i=new r;return i._tick=this._tick+t,i},m.prototype.note=function(t,r,i,e){return this.noteOn(t,r,i),e>0&&this.tick(e).noteOff(t,r),this},m.prototype.ch=function(t){if(void 0===t)return this;if(t!=parseInt(t)||t<0||t>15)throw RangeError("Bad channel value: "+t+" (must be from 0 to 15)");return new I(this._orig,t,this._tick)},I.prototype=new m,I.prototype.tick=function(t){if(t!=parseInt(t)||t<0)throw RangeError("Bad tick value: "+t);return t?new I(this._orig,this._chan,this._tick+t):this},I.prototype.ch=function(t){if(void 0===t)return this._orig.tick(this._tick);if(t!=parseInt(t)||t<0||t>15)throw RangeError("Bad channel value: "+t+" (must be from 0 to 15)");return t==this._chan?this:new I(this._orig,t,this._tick)},I.prototype.note=function(t,r,i){return this.noteOn(t,r),i&&this.tick(i).noteOff(t),this},t.lib.copyMidiHelpers(m,I),S.prototype.onEnd=function(){},S.prototype.onData=function(){},S.prototype.loop=function(t){t==parseInt(t)&&t>0?this._loop=t:this._loop=t?-1:0},S.prototype.play=function(){this.event=void 0,this.playing=!0,this.paused=!1,this._ptr=0,this._pos=0,this._ms=0,this._p0=0,this._st=i(),this._t0=this._st,this.tick()},S.prototype.stop=function(){this._pos=0,this._ms=0,this.playing=!1,this.event="stop",this.paused=void 0},S.prototype.pause=function(){this.event="pause"},S.prototype.resume=function(){this.playing||(this.paused?(this.event=void 0,this._st=i(),this._t0=this._st,this.playing=!0,this.paused=!1,this.tick()):this.play())},S.prototype.sndOff=function(){for(var r=0;r<16;r++)this._emit(t.MIDI.allSoundOff(r))},S.prototype.tick=function(){var r,e=i();for(this._pos=this._p0+(e-this._t0)*this.mul;this._ptr<this._data.length&&!((r=this._data[this._ptr]).tt>this._pos);this._ptr++)81==r.ff&&this.ppqn&&(this.mul=1e3*this.ppqn/((r.dd.charCodeAt(0)<<16)+(r.dd.charCodeAt(1)<<8)+r.dd.charCodeAt(2)),this._p0=this._pos-(e-this._t0)*this.mul),this._emit(r);this._ptr>=this._data.length&&(this._loop&&-1!=this._loop&&this._loop--,this._loop?(this._ptr=0,this._p0=0,this._t0=e,this._st=e,this._ms=0):this.stop(),this.onEnd()),"stop"==this.event&&(this.playing=!1,this.paused=!1,this._pos=0,this._ms=0,this._ptr=0,this.sndOff(),this.event=void 0),"pause"==this.event&&(this.playing=!1,this.paused=!0,this._ms+=i()-this._st,this._pos>=this._duration&&(this._pos=this._duration-1),this._p0=this._pos,this.sndOff(),this.event=void 0),this.playing&&t.lib.schedule(this._tick)},S.prototype.type=function(){return this._type},S.prototype.tracks=function(){return this._tracks},S.prototype.duration=function(){return this._duration},S.prototype.durationMS=function(){return this._durationMS},S.prototype.position=function(){return this._pos},S.prototype.positionMS=function(){return this.playing?this._ms+i()-this._st:this._ms},S.prototype.jump=function(t){isNaN(parseFloat(t))&&o("Not a number: "+t),t<0&&(t=0),t>=this._duration&&(t=this._duration-1),this._goto(t,this._t2ms(t))},S.prototype.jumpMS=function(t){isNaN(parseFloat(t))&&o("Not a number: "+t),t<0&&(t=0),t>=this._durationMS&&(t=this._durationMS-1),this._goto(this._ms2t(t),t)},S.prototype._t2ms=function(t){if(!t)return 0;var r;for(r=0;this._ttt[r].t<t;r++);return r--,this._ttt[r].ms+(t-this._ttt[r].t)/this._ttt[r].m},S.prototype._ms2t=function(t){if(!t)return 0;var r;for(r=0;this._ttt[r].ms<t;r++);return r--,this._ttt[r].t+(t-this._ttt[r].ms)*this._ttt[r].m},S.prototype._goto=function(t,r){this._pos=t,this._ms=r,this._p0=t,this._t0=i(),this._st=this._t0,this.playing||(this.paused=!!t),this._toPos(),this.playing&&this.sndOff()},S.prototype._toPos=function(){for(this._ptr=0;this._ptr<this._data.length&&(e=this._data[this._ptr],!(e.tt>=this._pos));this._ptr++)81==e.ff&&this.ppqn&&(this.mul=1e3*this.ppqn/((e.dd.charCodeAt(0)<<16)+(e.dd.charCodeAt(1)<<8)+e.dd.charCodeAt(2)),this._p0=this._pos-(i()-this._t0)*this.mul)},S.prototype.tick2ms=function(t){return isNaN(parseFloat(t))&&o("Not a number: "+t),t<=0?0:t>=this._duration?this._durationMS:this._t2ms(t)},S.prototype.ms2tick=function(t){return isNaN(parseFloat(t))&&o("Not a number: "+t),t<=0?0:t>=this._durationMS?this._duration:this._ms2t(t)},t.MIDI.SMF=f}function o(t){throw new Error(t)}function s(t){var r="";return t>2097151&&(r+=String.fromCharCode(128+(t>>21&127))),t>16383&&(r+=String.fromCharCode(128+(t>>14&127))),t>127&&(r+=String.fromCharCode(128+(t>>7&127))),r+=String.fromCharCode(127&t)}function h(t){return String.fromCharCode(t>>8)+String.fromCharCode(255&t)}function a(t){return String.fromCharCode(t>>24&255)+String.fromCharCode(t>>16&255)+String.fromCharCode(t>>8&255)+String.fromCharCode(255&t)}function p(t){return String.fromCharCode(255&t)+String.fromCharCode(t>>8&255)+String.fromCharCode(t>>16&255)+String.fromCharCode(t>>24&255)}function f(){var t,r,i=this instanceof f?this:i=new f,e=1,n=96;if(1==arguments.length){if(arguments[0]instanceof f)return arguments[0].copy();if("string"==typeof arguments[0]&&"0"!=arguments[0]&&"1"!=arguments[0]&&"2"!=arguments[0])return i.load(arguments[0]),i;e=parseInt(arguments[0])}else 2==arguments.length?(e=parseInt(arguments[0]),n=parseInt(arguments[1])):3==arguments.length?(e=parseInt(arguments[0]),t=parseInt(arguments[1]),r=parseInt(arguments[2])):arguments.length&&o("Invalid parameters");return(isNaN(e)||e<0||e>2)&&o("Invalid parameters"),i.type=e,void 0===t?((isNaN(n)||n<0||e>65535)&&o("Invalid parameters"),i.ppqn=n):(24!=t&&25!=t&&29!=t&&30!=t&&o("Invalid parameters"),(isNaN(r)||r<0||e>255)&&o("Invalid parameters"),i.fps=t,i.ppf=r),i}function d(t,r,i,e){var n={off:t,msg:r,data:i};return void 0!==e&&(n.tick=e),n}function u(t){var r={};for(var i in t)t.hasOwnProperty(i)&&(r[i]=t[i]);return r}function c(t){switch(240&t){case 128:case 144:case 160:case 176:case 224:return 2;case 192:case 208:return 1}switch(t){case 241:case 243:return 1;case 242:return 2}return 0}function _(t,r,i){var e;if(this.sub[t])return this.sub[t](t,r,i);for("string"==typeof t&&4==t.length||o("Invalid chunk type: "+t),e=0;e<t.length;e++)(t.charCodeAt(e)<0||t.charCodeAt(e)>255)&&o("Invalid chunk type: "+t);for("string"!=typeof r&&o("Invalid data type: "+r),e=0;e<r.length;e++)(r.charCodeAt(e)<0||r.charCodeAt(e)>255)&&o("Invalid data character: "+r[e]);this.type=t,this.data=r,this.offset=i}function l(t,r,i,e,n,o){var s=r.substr(i,e);s.length<e&&(t._complain(o,"Incomplete track data",e-s.length,n),s=(s+"\0\0").substr(0,e));for(var h=0;h<e;h++)s.charCodeAt(h)>127&&(t._complain(o,"Bad MIDI value",s.charCodeAt(h),n),s=s.substr(0,h)+"\0"+s.substr(h+1));return s}function g(t,r,i,e){var n=function(t){if(!t.length)return 0;if(t.charCodeAt(0)<128)return t.charCodeAt(0);var r=127&t.charCodeAt(0);return r<<=7,t.charCodeAt(1)<128?r+t.charCodeAt(1):(r+=127&t.charCodeAt(1),r<<=7,t.charCodeAt(2)<128?r+t.charCodeAt(2):(r+=127&t.charCodeAt(2),r<<=7,r+=127&t.charCodeAt(3),t.charCodeAt(3)<128?r:-r))}(r);return n<0&&(n=-n,t._complain(i,"Bad byte sequence",r.charCodeAt(0)+"/"+r.charCodeAt(1)+"/"+r.charCodeAt(2)+"/"+r.charCodeAt(3),e)),n}function m(t,r){if(this._orig=this,this._tick=0,void 0!==t){var i,e,n,o,s=0,h=0,a="";for(r=r||0,r+=8;h<t.length;)i=g(this,t.substr(h,4),o,s+i),h++,i>127&&h++,i>16383&&h++,i>2097151&&h++,s+=i,o=h+r,255==t.charCodeAt(h)?((e=t.substr(h,2)).length<2&&(this._complain(o,"Incomplete track data",3-e.length,s),e="ÿ/"),h+=2,n=g(this,t.substr(h,4),o+2,s),h++,n>127&&h++,n>16383&&h++,n>2097151&&h++,this.push(new A(s,e,t.substr(h,n),o)),h+=n):240==t.charCodeAt(h)||247==t.charCodeAt(h)?(e=t.substr(h,1),h+=1,n=g(this,t.substr(h,4),o+1,s),h++,n>127&&h++,n>16383&&h++,n>2097151&&h++,this.push(new A(s,e,t.substr(h,n),o)),h+=n):128&t.charCodeAt(h)?(a=t.substr(h,1),h+=1,(n=c(a.charCodeAt(0)))||this._complain(o,"Unexpected MIDI message",a.charCodeAt(0),s),this.push(new A(s,a,l(this,t,h,n,s,o),o)),h+=n):128&a.charCodeAt(0)&&((n=c(a.charCodeAt(0)))||this._complain(o,"Unexpected MIDI message",a.charCodeAt(0),s),this.push(new A(s,a,l(this,t,h,n,s,o),o)),h+=n)}else this.push(new A(0,"ÿ/",""))}function C(t,r,i){return t.dd.length<i?d(t._off,"Invalid "+r+" meta event: "+(t.dd.length?"data too short":"no data"),t.toString(),t.tt):t.dd.length>i?d(t._off,"Invalid "+r+" meta event: data too long",t.toString(),t.tt):void 0}function y(t){var r;if(void 0!==t.ff){if(t.ff>127)return d(t._off,"Invalid meta event",t.toString(),t.tt);if(0==t.ff){if(r=C(t,"Sequence Number",2))return r}else if(t.ff<10){if(!t.dd.length)return d(t._off,"Invalid Text meta event: no data",t.toString(),t.tt)}else if(32==t.ff){if(r=C(t,"Channel Prefix",1))return r;if(t.dd.charCodeAt(0)>15)return d(t._off,"Invalid Channel Prefix meta event: incorrect data",t.toString(),t.tt)}else if(33==t.ff){if(r=C(t,"MIDI Port",1))return r;if(t.dd.charCodeAt(0)>127)return d(t._off,"Invalid MIDI Port meta event: incorrect data",t.toString(),t.tt)}else if(47==t.ff){if(r=C(t,"End of Track",0))return r}else if(81==t.ff){if(r=C(t,"Tempo",3))return r}else if(84==t.ff){if(r=C(t,"SMPTE",5))return r;if(t.dd.charCodeAt(0)>=24||t.dd.charCodeAt(1)>=60||t.dd.charCodeAt(2)>=60||t.dd.charCodeAt(3)>=30||t.dd.charCodeAt(4)>=200||t.dd.charCodeAt(4)%25)return d(t._off,"Invalid SMPTE meta event: incorrect data",t.toString(),t.tt)}else if(88==t.ff){if(r=C(t,"Time Signature",4))return r;if(t.dd.charCodeAt(1)>8)return d(t._off,"Invalid Time Signature meta event: incorrect data",t.toString(),t.tt)}else if(89==t.ff){if(r=C(t,"Key Signature",2))return r;if(t.dd.charCodeAt(1)>1||t.dd.charCodeAt(0)>255||t.dd.charCodeAt(0)>7&&t.dd.charCodeAt(0)<249)return d(t._off,"Invalid Key Signature meta event: incorrect data",t.toString(),t.tt)}else if(127!=t.ff)return d(t._off,"Unknown meta event",t.toString(),t.tt)}}function v(t){var r={0:0,3:1,2:2,84:3,81:4,88:5,89:6,32:7,33:7,6:8,4:9,1:16,5:16,127:17,47:20}[t.ff];if(void 0!==r)return r;if(t.length){var i=t[0]>>4;if(void 0!==(r={8:10,15:11,11:12,12:13,10:15,13:15,14:15}[i]))return r;if(9==i)return t[1]?14:10}return 18}function I(t,r,i){this._orig=t,this._chan=r,this._tick=i}function A(r,i,e,n){var o;if(255==i.charCodeAt(0))o=t.MIDI.smf(i.charCodeAt(1),e);else{for(var s=[i.charCodeAt(0)],h=0;h<e.length;h++)s.push(e.charCodeAt(h));o=t.MIDI(s)}return void 0!==n&&(o._off=n),o.tt=r,o}function S(){var i,e=new t.Widget;for(var n in e._info.name="MIDI Player",e._info.manufacturer="Jazz-Soft",e._info.version=r,e.playing=!1,e._loop=0,e._data=[],e._pos=0,e._ms=0,e._tick=(i=e,function(){i.tick()}),S.prototype)S.prototype.hasOwnProperty(n)&&(e[n]=S.prototype[n]);return e}});
//# sourceMappingURL=/sm/482d64bb1c5a7d74268a3cc66192e20d11fd22d48d6fc7a42e76ff4620d7a891.map